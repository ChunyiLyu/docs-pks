---
title: Preparing to Deploy PKS on AWS
owner: Ops Manager
---

<strong><%= modified_date %></strong>
<html class="list-style-none"></html>

This guide describes the preparation steps required to install Pivotal Container Service (PKS) on Amazon Web Services (AWS).

In addition to fulfilling the prerequisites listed in the [AWS Prerequisites and Resource Requirements](aws-requirements.html) topic,
you must create resources in AWS such policies and users for the master and worker VMs before deploying PKS.
Follow these procedures to prepare your AWS environment.

## <a id='om-instance-profile'></a>Modify OM IAM Role

To allow Ops Manager to assign the Master and Worker instance profiles to each Virtual Machine, the following inline policy should be added to the Ops Manager IAM Role.

1. Log in to the [AWS Management Console](https://aws.amazon.com/console/).
1. Select **IAM > Policies**.
1. Select Ops Manager IAM Role for your environment.
1. Click **Add policy**.
1. Click **JSON**.
1. Copy the following policy and paste it into the policy field:
<pre>
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": "iam:PassRole",
            "Resource": "*"
        }
    ]
}
</pre>

## <a id='instance-profiles'></a>Create IAM Instance Profiles

In order for Kubernetes to create load balancers and attach persistent disks to pods, you must create users with sufficient permissions.

To set up accounts with the correct permissions, create master and worker VM policies and associate them to users.

### <a id='master-policy'></a>Step 1: Create the Master Node Policy

1. Log in to the [AWS Management Console](https://aws.amazon.com/console/).
1. Select **IAM > Policies**.
1. Click **Create policy**.
1. Click **JSON**.
1. Copy the following policy and paste it into the policy field:
   <pre>
   {
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "s3:\*",
            "Resource": [
                "arn:aws:s3:::kubernetes-\*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": "ec2:Describe\*",
            "Resource": "\*"
        },
        {
            "Effect": "Allow",
            "Action": "ec2:AttachVolume",
            "Resource": "\*"
        },
        {
            "Effect": "Allow",
            "Action": "ec2:DetachVolume",
            "Resource": "\*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "ec2:\*"
            ],
            "Resource": [
                "\*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "elasticloadbalancing:\*"
            ],
            "Resource": [
                "\*"
            ]
        }
    ]
    }
    </pre>
1. Click **Review policy**.
1. Give the policy a name. For example, `pks-master-policy`.
1. Click **Create policy**.

### <a id='create-master'></a>Step 2: Create the Master Node Instance Profile

1. From the AWS Management Console, select **IAM > Users**.
1. Click **Add user**.
1. Give the user a name. For example, `pks-master`.
1. Select **Access type** - **Programmatic access**.
1. Click **Next: Permissions**.
1. Click **Attach existing policies directly**.
1. Select the policy you created in the previous section. For example, `pks-master-policy`.
1. Click **Next: Review**.
1. Click **Create user**.

### <a id='worker-policy'></a>Step 3: Create the Worker Node Policy

1. From the AWS Management Console, select **IAM > Policies**.
1. Click **Create policy**.
1. Click **JSON**.
1. Copy the following policy and paste it into the policy field:
   <pre>
   {
    "Version": "2012-10-17",
    "Statement": [
        {
            "Action": "ec2:Describe\*",
            "Effect": "Allow",
            "Resource": "\*"
        },
        {
            "Action": "ec2:AttachVolume",
            "Effect": "Allow",
            "Resource": "\*"
        },
        {
            "Action": "ec2:DetachVolume",
            "Effect": "Allow",
            "Resource": "\*"
        }
    ]
    }
    </pre>
1. Click **Review policy**.
1. Give the policy a name. For example, `pks-worker-policy`.
1. Click **Create policy**.

### <a id='create-worker'></a>Step 4: Create the Worker Node Instance Profile

1. From the AWS Management Console, select **IAM > Users**.
1. Click **Add user**.
1. Give the user a name. For example, `pks-worker`.
1. Select **Access type** - **Programmatic access**.
1. Click **Next: Permissions**.
1. Click **Attach existing policies directly**.
1. Select the policy you created in the previous section. For example, `pks-worker-policy`.
1. Click **Next: Review**.
1. Click **Create user**.

## <a id='next-steps'></a>Next Steps

Follow the procedures in [Deploying Ops Manager to AWS](aws-om-deploy.html).
